@if (coreService.isLoading) {
  <app-skeleton [type]="SkeletonEnum.CARD"></app-skeleton>
}

@if (!coreService.isLoading) {
  <p-toolbar>
    <div class="p-toolbar-group-left">
      <app-header-form [id]="id"></app-header-form>
    </div>
    <div class="p-toolbar-group-right">
      <button pButton pRipple type="button"
              (click)="back()"
              [icon]="IconButtonActionEnum.CANCEL"
              [label]="LabelButtonActionEnum.CANCEL"
              [loading]="coreService.isLoading"
              [ngClass]="[ClassButtonActionEnum.CANCEL]"></button>
      <p-divider layout="vertical"></p-divider>
      <button pButton pRipple type="button"
              (click)="onSubmit()"
              [icon]="IconButtonActionEnum.SAVE"
              [label]="LabelButtonActionEnum.SAVE"
              [loading]="coreService.isLoading"
              [ngClass]="[ClassButtonActionEnum.SAVE]"></button>
    </div>
  </p-toolbar>

  <p-panel class="p-fluid">
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <div class="field">
        <label appLabel for="parent" [label]="TransactionsFormEnum.parent"
          [required]="parentField"></label>
        <p-dropdown id="parent" dataKey="id" formControlName="parent" [options]="transactions"
          optionLabel="name" [filter]="true" filterBy="name" placeholder="Seleccione...">
          <ng-template pTemplate="selectedItem">
            @if(parentField.value){
            <div>
              <div>{{ parentField.value.name }}</div>
            </div>
            }
          </ng-template>
          <ng-template let-item pTemplate="item">
            <div>{{ item.name }}</div>
          </ng-template>
        </p-dropdown>
        <small appErrorMessage [errors]="parentField.errors" [touched]="parentField.touched"
          [dirty]="parentField.dirty">
        </small>
      </div>
      <div class="formgrid grid">
        <div class="field xl:col-6 lg:col-6 md:col-6 sm:col-12">
          <label appLabel for="process" [label]="TransactionsFormEnum.process"
                 [required]="processField"></label>
          <p-dropdown id="process"
                      dataKey="id"
                      formControlName="process"
                      [options]="transactions"
                      optionLabel="name"
                      [filter]="true"
                      filterBy="name"
                      placeholder="Seleccione...">
            <ng-template pTemplate="selectedItem">
              @if (processField.value) {
                <div>{{ processField.value.name }}</div>
              }
            </ng-template>
            <ng-template let-item pTemplate="item">
              <div>{{ item.name }}</div>
            </ng-template>
          </p-dropdown>
          <small appErrorMessage
                 [errors]="processField.errors"
                 [touched]="processField.touched"
                 [dirty]="processField.dirty">
          </small>
        </div>
        <div class="field xl:col-6 lg:col-6 md:col-6 sm:col-12">
          <label appLabel for="documentType" [label]="TransactionsFormEnum.documentType"
                 [required]="documentTypeField"></label>
          <p-dropdown id="documentType"
                      dataKey="id"
                      formControlName="documentType"
                      [options]="documentTypes"
                      optionLabel="name"
                      [filter]="true"
                      filterBy="name"
                      placeholder="Seleccione...">
            <ng-template pTemplate="selectedItem">
              @if (documentTypeField.value) {
                <div>{{ documentTypeField.value.name }}</div>
              }
            </ng-template>
            <ng-template let-item pTemplate="item">
              <div>{{ item.name }}</div>
            </ng-template>
          </p-dropdown>
          <small appErrorMessage
                 [errors]="documentTypeField.errors"
                 [touched]="documentTypeField.touched"
                 [dirty]="documentTypeField.dirty">
          </small>
        </div>
      </div>
      <div class="formgrid grid">
        <div class="field xl:col-6 lg:col-6 md:col-6 sm:col-12">
          <label appLabel for="applicationStatus" [label]="TransactionsFormEnum.applicationStatus"
                 [required]="applicationStatusField"></label>
          <p-dropdown id="applicationStatus"
                      dataKey="id"
                      formControlName="applicationStatus"
                      [options]="applicationStatus"
                      optionLabel="name"
                      [filter]="true"
                      filterBy="name"
                      placeholder="Seleccione...">
            <ng-template pTemplate="selectedItem">
              @if (applicationStatusField.value) {
                <div>{{ applicationStatusField.value.name }}</div>
              }
            </ng-template>
            <ng-template let-item pTemplate="item">
              <div>{{ item.name }}</div>
            </ng-template>
          </p-dropdown>
          <small appErrorMessage
                 [errors]="applicationStatusField.errors"
                 [touched]="applicationStatusField.touched"
                 [dirty]="applicationStatusField.dirty">
          </small>
        </div>
        <div class="field xl:col-6 lg:col-6 md:col-6 sm:col-12">
          <label appLabel for="fiscalYear" [label]="TransactionsFormEnum.fiscalYear"
                 [required]="fiscalYearField"></label>
          <p-dropdown id="fiscalYear"
                      dataKey="id"
                      formControlName="fiscalYear"
                      [options]="fiscalYears"
                      optionLabel="name"
                      [filter]="true"
                      filterBy="name"
                      placeholder="Seleccione...">
            <ng-template pTemplate="selectedItem">
              @if (fiscalYearField.value) {
                <div>{{ fiscalYearField.value.name }}</div>
              }
            </ng-template>
            <ng-template let-item pTemplate="item">
              <div>{{ item.name }}</div>
            </ng-template>
          </p-dropdown>
          <small appErrorMessage
                 [errors]="fiscalYearField.errors"
                 [touched]="fiscalYearField.touched"
                 [dirty]="fiscalYearField.dirty">
          </small>
        </div>
      </div>
      <div class="formgrid grid">
        <div class="field xl:col-6 lg:col-6 md:col-6 sm:col-12">
          <label appLabel for="unit" [label]="TransactionsFormEnum.unit"
                 [required]="unitField"></label>
          <p-dropdown id="unit"
                      dataKey="id"
                      formControlName="unit"
                      [options]="units"
                      optionLabel="name"
                      [filter]="true"
                      filterBy="name"
                      placeholder="Seleccione...">
            <ng-template pTemplate="selectedItem">
              @if (unitField.value) {
                <div>{{ unitField.value.name }}</div>
              }
            </ng-template>
            <ng-template let-item pTemplate="item">
              <div>{{ item.name }}</div>
            </ng-template>
          </p-dropdown>
          <small appErrorMessage
                 [errors]="unitField.errors"
                 [touched]="unitField.touched"
                 [dirty]="unitField.dirty">
          </small>
        </div>
        <div class="field xl:col-6 lg:col-6 md:col-6 sm:col-12">
          <label appLabel for="principalUnit" [label]="TransactionsFormEnum.principalUnit"
                 [required]="principalUnitField"></label>
          <p-dropdown id="principalUnit"
                      dataKey="id"
                      formControlName="principalUnit"
                      [options]="units"
                      optionLabel="name"
                      [filter]="true"
                      filterBy="name"
                      placeholder="Seleccione...">
            <ng-template pTemplate="selectedItem">
              @if (principalUnitField.value) {
                <div>{{ principalUnitField.value.name }}</div>
              }
            </ng-template>
            <ng-template let-item pTemplate="item">
              <div>{{ item.name }}</div>
            </ng-template>
          </p-dropdown>
          <small appErrorMessage
                 [errors]="principalUnitField.errors"
                 [touched]="principalUnitField.touched"
                 [dirty]="principalUnitField.dirty">
          </small>
        </div>
      </div>
      <div class="formgrid grid">
        <div class="field xl:col-4 lg:col-4 md:col-4 sm:col-12">
          <label appLabel for="code" [label]="TransactionsFormEnum.code" [required]="codeField"></label>
          <input pInputText type="text" id="code" formControlName="code"/>
          <small appErrorMessage
                 [errors]="codeField.errors"
                 [touched]="codeField.touched"
                 [dirty]="codeField.dirty">
          </small>
        </div>
        <div class="field xl:col-4 lg:col-4 md:col-4 sm:col-12">
          <label appLabel for="subject" [label]="TransactionsFormEnum.subject" [required]="subjectField"></label>
          <input pInputText type="text" id="subject" formControlName="subject"/>
          <small appErrorMessage
                 [errors]="subjectField.errors"
                 [touched]="subjectField.touched"
                 [dirty]="subjectField.dirty">
          </small>
        </div>
        <div class="field xl:col-4 lg:col-4 md:col-4 sm:col-12">
          <label appLabel for="esigef" [label]="TransactionsFormEnum.esigef" [required]="esigefField"></label>
          <input pInputText type="text" id="esigef" formControlName="esigef"/>
          <small appErrorMessage
                 [errors]="esigefField.errors"
                 [touched]="esigefField.touched"
                 [dirty]="esigefField.dirty">
          </small>
        </div>
      </div>
      <div class="formgrid grid">
        <div class="field xl:col-3 lg:col-3 md:col-3 sm:col-12">
          <label appLabel for="value" [label]="TransactionsFormEnum.value" [required]="valueField"></label>
          <p-inputNumber id="value" formControlName="value" [min]="1"></p-inputNumber>
          <small appErrorMessage [errors]="valueField.errors" [touched]="valueField.touched" [dirty]="valueField.dirty">
          </small>
        </div>
        <div class="field xl:col-3 lg:col-3 md:col-3 sm:col-12">
          <label appLabel for="description" [label]="TransactionsFormEnum.description" [required]="descriptionField"></label>
          <input pInputText type="text" id="description" formControlName="description"/>
          <small appErrorMessage
                 [errors]="descriptionField.errors"
                 [touched]="descriptionField.touched"
                 [dirty]="descriptionField.dirty">
          </small>
        </div>
        <div class="field xl:col-2 lg:col-2 md:col-2 sm:col-12">
          <label appLabel for="isIva" [label]="TransactionsFormEnum.isIva" [required]="isIvaField"></label>
          <p>
            <p-inputSwitch id="isIva" formControlName="isIva"></p-inputSwitch>
          </p>
          <small appErrorMessage [errors]="isIvaField.errors" [touched]="isIvaField.touched"
            [dirty]="isIvaField.dirty">
          </small>
        </div>
        <div class="field xl:col-2 lg:col-2 md:col-2 sm:col-12">
          <label appLabel for="enabled" [label]="TransactionsFormEnum.enabled" [required]="enabledField"></label>
          <p>
            <p-inputSwitch id="enabled" formControlName="enabled"></p-inputSwitch>
          </p>
          <small appErrorMessage [errors]="enabledField.errors" [touched]="enabledField.touched"
            [dirty]="enabledField.dirty">
          </small>
        </div>
        <div class="field xl:col-2 lg:col-2 md:col-2 sm:col-12">
          <label appLabel for="state" [label]="TransactionsFormEnum.state" [required]="stateField"></label>
          <p>
            <p-inputSwitch id="state" formControlName="state"></p-inputSwitch>
          </p>
          <small appErrorMessage [errors]="stateField.errors" [touched]="stateField.touched"
            [dirty]="stateField.dirty">
          </small>
        </div>
      </div>
    </form>
  </p-panel>
}

